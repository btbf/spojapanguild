# SJG ä¿®æ­£ãƒ—ãƒ­ã‚°ãƒ©ãƒ 

## **envãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ**

!!! info ""
    æœ€çµ‚æ›´æ–°æ—¥ï¼š2022/02/19 v1.0


**æ¦‚è¦**

**â– ç™ºç”Ÿäº‹è±¡**  
gliveview.sh/cncli.shå®Ÿè¡Œæ™‚ã«ã€å®Ÿè¡Œã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«env/gliveview.sh/cncli.shãŒç”Ÿæˆã•ã‚Œã¦ã—ã¾ã†ã€‚

**â– åŸå› **  
envå†…ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆé–¢æ•°å‡¦ç†å¤‰æ›´ã«ä¼´ã†ã‚‚ã®

**â– ä¿®æ­£ãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…å®¹**  
â‡’.bashrcå†…aliasã«è¨­å®šä¸­ã®å¤‰æ•°(glive/blocks)ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å¤‰æ›´  
â‡’cncliç³»ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®WorkingDirectoryã‚’å¤‰æ›´

**â– å¯¾è±¡è€…**
* ãƒ—ãƒ¼ãƒ«æ§‹ç¯‰ä¸­ã§ãƒ–ãƒ­ãƒƒã‚¯ãƒ­ã‚°ã®è¨­å®šã¾ã§å®Œäº†ã—ãŸæ–¹
* ãƒ—ãƒ¼ãƒ«é‹å–¶ä¸­SPOã®æ–¹

**â– å¯¾è±¡ã‚µãƒ¼ãƒãƒ¼**  
BP/ãƒªãƒ¬ãƒ¼  

### **â– ä¿®æ­£ãƒ—ãƒ­ã‚°ãƒ©ãƒ é©ç”¨æ‰‹é †**

#### BPï¼ãƒªãƒ¬ãƒ¼å…±é€š

**1.ä¿®æ­£ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹(BPï¼ãƒªãƒ¬ãƒ¼å…±é€š)**
```
cd $NODE_HOME/scripts
wget -q https://raw.githubusercontent.com/btbf/coincashew/master/guild-tools/service_fixed.sh -O service_fixed.sh
```

**2.ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’è¨­å®šã—ã€å®Ÿè¡Œã™ã‚‹**
```
chmod 755 service_fixed.sh
./service_fixed.sh
```

**3.ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒçµ‚äº†ã™ã‚‹ã®ã‚’å¾…ã¤**

**4. bashrcã‚’èª­ã¿è¾¼ã‚€**
```
source $HOME/.bashrc
```


**5.ä¿®æ­£ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å‰Šé™¤ã™ã‚‹**
```
cd $NODE_HOME/scripts
rm service_fixed.sh
```

**6.ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆç¢ºèªå¯¾å¿œ**

```
cd $HOME
glive
```
> Script update(s) detected, do you want to download the latest version? (yes/no):***_yes_*** 

**å†åº¦ã€gliveviewã‚’å®Ÿè¡Œã™ã‚‹**
```
cd $HOME
glive
```
ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆç¢ºèªãŒå‡ºãªããªã‚‹ã¾ã§**_yes_** ã§å¯¾å¿œã™ã‚‹ã€‚


#### BPã®ã¿


**9.ï¼ˆBPã®ã¿ï¼‰å„ã‚µãƒ¼ãƒ“ã‚¹ãŒå‹•ã„ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹**
!!! info ""
    è¤‡æ•°ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆç¢ºèªãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ãŒã€ã©ã‚Œã‹ï¼‘ã¤ã§`yes`ã«ã—ãŸã‚‰ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯`no`ã«ã—ã¦ãã ã•ã„  
    ä¾‹ï¼‰  
    * tmux a -t cncliã§ã¯`yes`  
    `Script update(s) detected, do you want to download the latest version? (yes/no):yes`  
    ã€€  
    * tmux a -t validateã§ã¯`no`  
    `Script update(s) detected, do you want to download the latest version? (yes/no):no`


```
tmux a -t cncli
```
```
tmux a -t validate
```
```
tmux a -t leaderlog
```
```
tmux a -t logmonitor
```

!!! info ""
tmux a -t leaderlogã¯ã€ä»Šå›ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã¯ä¸­æ–­å‡¦ç†ã‚’å…¥ã‚Œã¦ã‚‹ã®ã§ä»¥ä¸‹ã®è¡¨è¨˜ã«ãªã£ã¦ã„ã¾ã™ãŒå•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

    > Checking for script updates...  
    > ^C  

    æ¬¡ã‚¨ãƒãƒƒã‚¯ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å–å¾—ã—ãŸã„å ´åˆã¯ã€åˆ¥é€”ãƒãƒ¼ãƒ‰ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚



ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚


## ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåä¿®æ­£

æœ€çµ‚æ›´æ–°æ—¥ï¼š2021å¹´12æœˆ27æ—¥ã®æ™‚ç‚¹ã€€version 2.2

!!! info "æ¦‚è¦"
    * ãƒãƒ¼ãƒ‰ã‚’æ­¢ã‚ã‚‹ãŸã‚ã€ãƒ–ãƒ­ãƒƒã‚¯ç”Ÿæˆäºˆå®šãŒç„¡ã„æ™‚é–“å¸¯ã«å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
    * BP/ãƒªãƒ¬ãƒ¼ã¯è‡ªå‹•åˆ¤å®šã—ã€ãã‚Œãã‚Œã®ä¾å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ã—ã¾ã™ã€‚  
    * ç’°å¢ƒå¤‰æ•°$NODE_HOMEã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒ‘ã‚¹ã‚’èª­ã¿å–ã‚Šè‡ªå‹•ç½®æ›ã—ã¾ã™ã€‚  
    ex) /home/user/cardano-my-node â‡’ /home/user/cnode  
    ex) /home/user/cardano-node â‡’ /home/user/cnode
    * ç¾åœ¨è¨­å®šä¸­ã®ãƒãƒ¼ãƒ‰ãƒãƒ¼ãƒˆç•ªå·ã‚„ãƒ—ãƒ¼ãƒ«IDã‚’èª­ã¿å–ã‚Šã€å„ãƒ•ã‚¡ã‚¤ãƒ«ã«è‡ªå‹•åæ˜ ã—ã¾ã™ã€‚


!!! danger "æ³¨æ„"
    ğŸ›‘ **æ—¥æœ¬èªãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã§ä½¿ã‚ã‚Œã¦ã‚‹å„ç¨®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ä»»æ„ã®åå‰ã«å¤‰æ›´ã—ã¦ã„ã‚‹å ´åˆã¯ã€æ­£ã—ãå‹•ä½œã—ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚** ğŸš§  
    ã‚‚ã—ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚„ã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å¤‰æ›´ã—ã¦ã„ã‚‹å ´åˆã¯å®Ÿè¡Œå‰ã«BTBFã¾ã§ã”ç›¸è«‡ãã ã•ã„ã€‚


### 1. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹

```bash
cd $HOME
wget -q https://raw.githubusercontent.com/btbf/coincashew/master/guild-tools/dirname_cng.sh -O dirname_cng.sh
```

### 2.ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹

```bash
chmod 755 dirname_cng.sh
./dirname_cng.sh
```

> ç”»é¢ã®æŒ‡ç¤ºã«å¾“ã£ã¦é€²ã‚ã¦ãã ã•ã„ã€‚

### 3.èµ·å‹•ç¢ºèª


ãƒãƒ¼ãƒ‰ãƒ­ã‚°è¡¨ç¤º
```
journalctl --unit=cardano-node --follow
```
> ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã‚‹å ´åˆã¯ã€$HOMEç›´ä¸‹ã«ã‚ã‚‹ã€Œdirname-ï¼Šï¼Šï¼Š.logã€ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚®ãƒ«ãƒ‰ã«æå‡ºã—ã¦ãã ã•ã„ã€‚

ç’°å¢ƒå¤‰æ•°ç¢ºèª
```
source $HOME/.bashrc
echo $NODE_HOME
```
> ä¾‹) /home/user/cnodeã€€ã¨è¡¨ç¤ºã•ã‚Œã‚Œã°OK 


gliveviewç¢ºèª
> è¡¨ç¤ºã§ãã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚
> Script update(s) detected, do you want to download the latest version? (yes/no):ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆã¯ã€å‡ºãªããªã‚‹ã¾ã§ `Y`

ãƒãƒ¼ãƒ‰åˆ¥ç¢ºèªäº‹é …

=== "ãƒªãƒ¬ãƒ¼ãƒãƒ¼ãƒ‰1"

    clontabç¢ºèª
    ```
    crontab -l
    ```
    >ã€€ä¾‹ï¼‰ "22 * * * * /home/user/cnode/topologyUpdater.sh" ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚Œã°OK  



=== "ãƒ–ãƒ­ãƒƒã‚¯ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ãƒãƒ¼ãƒ‰"

    ãƒ–ãƒ­ãƒƒã‚¯ãƒ­ã‚°èµ·å‹•ç¢ºèª
    ```
    tmux a -t cncli
    ```
    > ï½ï½ï½100.00% syncedãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰OK  
    > èµ¤æ–‡å­—ã¯ãƒãƒ¼ãƒ‰ãŒåŒæœŸã™ã‚‹ã¾ã§è¡¨ç¤ºã•ã‚Œã‚‹æ–‡ç« ã§ã‚ã‚Šã€ã‚¨ãƒ©ãƒ¼ã§ã¯ãªã„ã®ã§ãƒãƒ¼ãƒ‰ãŒåŒæœŸã™ã‚‹ã¾ã§ãŠå¾…ã¡ãã ã•ã„

    ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆè­¦å‘Šæ–‡ãŒã‚ã‚‹å ´åˆ
    > Script update(s) detected, do you want to download the latest version? (yes/no):ã€ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ `Y`
    ãƒ‡ã‚¿ãƒƒãƒã—ã¦ã‹ã‚‰ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•
    ```
    sudo systemctl reload-or-restart cnode-cncli-sync.service
    ```

    å†åº¦ç¢ºèª
    ```
    tmux a -t cncli
    ```
    > ï½ï½ï½100.00% syncedãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰OK  


å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤

```
rm $HOME/dirname_cng.sh
```

### 4.ã‚¨ã‚¢ã‚®ãƒ£ãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåå¤‰æ›´
!!! info ""
    ã‚¨ã‚¢ã‚®ãƒ£ãƒƒãƒ—ã§ã¯ã€ä¸Šè¨˜ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚


```
cd $HOME
mv ./cardano-my-node ./cnode
```

```
sed -e "s@cardano-my-node@cnode@g" -i $HOME/.bashrc
source $HOME/.bashrc
echo $NODE_HOME
```
> ä¾‹) /home/user/cnodeã€€ã¨è¡¨ç¤ºã•ã‚Œã‚Œã°OK 